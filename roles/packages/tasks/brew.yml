---
# Homebrew package installation

- name: Set Homebrew paths based on OS
  ansible.builtin.set_fact:
    homebrew_prefix: "{{ '/opt/homebrew' if ansible_facts['os_family'] == 'Darwin' and ansible_facts['architecture'] == 'arm64' else '/usr/local' if ansible_facts['os_family'] == 'Darwin' else '/home/linuxbrew/.linuxbrew' }}"

- name: Check if Homebrew is installed
  ansible.builtin.stat:
    path: "{{ homebrew_prefix }}/bin/brew"
  register: homebrew_check

- name: Install Homebrew packages
  community.general.homebrew:
    name: "{{ brew_packages_to_install }}"
    state: present
    path: "{{ homebrew_prefix }}/bin"
  when:
    - homebrew_check.stat.exists
    - brew_packages_to_install | default([]) | length > 0
  environment:
    PATH: "{{ homebrew_prefix }}/bin:{{ ansible_facts['env']['PATH'] }}"
