---
# Flatpak package installation for Linux GUI apps

- name: Check if Flatpak is installed
  ansible.builtin.command:
    cmd: which flatpak
  register: flatpak_check
  changed_when: false
  failed_when: false

- name: Add Flathub remote
  become: true
  ansible.builtin.command:
    cmd: flatpak remote-add --if-not-exists {{ flatpak_remote }} {{ flatpak_remote_url }}
  when: flatpak_check.rc == 0
  register: flathub_add
  changed_when: "'already exists' not in flathub_add.stderr"
  failed_when: false

- name: Install Flatpak GUI applications
  become: true
  community.general.flatpak:
    name: "{{ item }}"
    state: present
    remote: "{{ flatpak_remote }}"
  loop: "{{ gui_apps_to_install }}"
  when:
    - flatpak_check.rc == 0
    - gui_apps_to_install is defined
    - gui_apps_to_install | length > 0
  failed_when: false
